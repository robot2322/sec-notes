## 0x01 安全编程基础

### 1.1 防范缓冲区溢出

- 禁用危险的API
- 检查数据长度
- 使用安全函数或函数库
- 内存防护

### 1.2 防范整数溢出

- 检验所有的整数输入是否都位于上下界范围内。上下界的选择应当使得任何后续计算结果都不会超出所使用变量的容量限制。

### 1.3 处理竞争条件

- 共享资源加锁

### 1.4 正确处理异常

- 不要在错误响应中泄露敏感信息，包括：系统的详细信息、会话标识符或者帐号信息；
- 使用错误处理以避免显示调试或堆栈跟踪信息；
- 使用通用的错误消息并使用定制的错误页面；
- 应用程序应当处理应用程序错误， 并且不依赖服务器配置；
- 当错误条件发生时，适当清空分配的内存。

### 1.5 防范交互参数安全问题

- 不要信任可以被攻击者设置的文件名。
- 不要信任可以被不可信用户控制的文件内容，如浏览或编辑由攻击者发送来的文件。
- 避免从当前目录中获得配置信息。
- 不要让攻击者控制任何临时文件。

### 1.6 防范拒绝服务攻击

#### 1.6.1 占用内存导致的拒绝服务攻击

​	不要为用户分配较大的内存空间，不要让攻击者轻易实施可导致系统较高开销的操作。

#### 1.6.2 网络资源导致的拒绝服务攻击

​	除了应用层鉴别方法，还可以通过网络层进行初步识别，排除发送到或来自广播网地址或使用保留端口的数据源，以有效阻断这类攻击。

#### 1.6.3 消耗特定资源的拒绝服务攻击

​	将资源配额和超时链接相结合，缓解这类威胁发生的可能。

## 0x02 web应用安全编程

### 2.1 防范SQL注入

- 不要使用动态拼装sql，可以使用参数化的sql或者直接使用存储过程进行数据查询存取。
- 使用白名单模式，过滤掉敏感字符。

### 2.2 防范XSS漏洞

- 用HTML对输出进行编码。
- 使用HttpOnly的cookie选项。

### 2.3 防范重定向漏洞

- 对跳转路径进行验证，确保只跳转到可信的URL地址。

### 2.4 防范跨站请求伪造漏洞

- 在服务器端检查提交令牌与用户会话对象令牌是否匹配。
- 在注销和会话超时，删除用户对象会话和会话销毁。
- 增加token属性，使token对每个用户会话来说应该是唯一的，或者是对每个请求是唯一的。
- 敏感操作尽量使用POST，不使用GET方法。

## 0x03 数据安全编程

### 3.1 常用密码算法和接口库

#### 3.1.1 我国自主设计的密码算法

| 算法 | 类型           | 位数                      | 说明                                                         |
| ---- | -------------- | ------------------------- | ------------------------------------------------------------ |
| SM1  | 对称加密算法   | 128位（分组长度和密钥长度 | 算法安全保密强度及实现性能与AES算法相当
算法细节尚未公开。    |
| SM2  | 非对称加密算法 | 256位（加密强度           | 基于ECC算法<br/>安全性能比RSA1024有明显优势<br/>已公布算法细节 |
| SM3  | 哈希算法       | 256位（哈希值）           | 安全保密强度高于MD5<br/>已公布算法细节                       |
| SM4  | 对称加密算法   | 128位（加密强度）         | 随WAPI标准一起被公布                                         |

#### 3.1.2 接口库

- MIRACL
- OpenSSL
- CryptoAPI

### 3.2 随机数生成

​	程序员可调用密码函数库中提供的随机数生成函数，以得到更好的随机数。

### 3.3 选择加密算法

​	调用国际国内流行或符合国家政策要求的加密算法，并正确生成和使用加密密钥。

### 3.4 密钥生成和使用

- 每次加密时，使用临时生成的密钥来加密，该密钥仅在这一次通话会话中使用，使用后删除，下次通话会话重新产生新的会话密钥；
- 每次生成密钥时，不自己指定密钥，而是使用密钥生成函数来得到密钥；
- 密钥传递时使用非对称加密保护，有可能还可以使用另外一条线路来传输；
- 除了采取发送方（加密方）生成密钥的方式，还可以采取双方协商产生密钥的方式，而且使用国内外公认的密钥协商协议来产生会话密钥。

### 3.5 加盐哈希计算

- 加盐哈希算法是做哈希计算时，先在明文中混入一段“随机”的字符串再进行计算，这个字符串被称作盐值。
- 这样每次对相同的明文做哈希运算都会得到不同的哈希值。为了验证输入口令的正确性，需要将哈希值和盐值一起存储。
- 为了保证哈希计算的安全强度，还应该做到每次哈希计算都使用不同的盐，而且不能使用太短的盐。一个值得推荐的做法是使用和哈希算法输出长度等长的盐，并且盐使用随机数函数计算生成。

